<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ç–æ—Ä–∏—á–Ω–∞—è –≤—ã–≥–æ–¥–∞: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å</title>
    <style>
        :root { --blue: #2563eb; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { background: var(--card); width: 100%; max-width: 600px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .progress-line { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; margin: 15px 0 5px 0; }
        .fill { height: 100%; background: var(--blue); width: 0%; transition: 0.3s; }
        .status-text { color: var(--blue); font-size: 1.3em; font-weight: 600; text-align: center; margin-bottom: 10px; }
        .q-text { font-size: 1.3em; font-weight: 600; text-align: center; margin: 10px 0 30px 0; min-height: 70px; }
        .options { display: grid; gap: 10px; }
        .btn { padding: 14px; border: 2px solid #e2e8f0; background: white; border-radius: 12px; cursor: pointer; font-size: 1em; transition: 0.1s; }
        .btn:hover { border-color: var(--blue); background: #f8fafc; }
        .input-name { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; margin-bottom: 20px; box-sizing: border-box; font-size: 1em; }
        .scale-box { border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 8px; }
        .scale-head { padding: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 0.95em; }
        .scale-body { max-height: 0; overflow: hidden; transition: 0.3s; background: #fdfdfd; padding: 0 12px; font-size: 0.9em; color: #64748b; }
        .scale-body.open { max-height: 500px; padding: 12px; border-top: 1px solid #e2e8f0; }
        .bar-wrap { height: 6px; background: #eee; width: 60px; border-radius: 3px; margin-left: 10px; }
        .bar-inner { height: 100%; background: var(--blue); border-radius: 3px; }
        .hidden { display: none; }
        .admin-block { background: #f1f5f9; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        @media print { .no-print { display: none; } .container { box-shadow: none; width: 100%; max-width: 100%; } }
    </style>
</head>
<body>

<div class="container">
    <div id="start-ui" class="admin-block no-print">
        <div style="font-weight:bold; margin-bottom:10px;">–î–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞</div>
        <input type="text" id="patientName" class="input-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞...">
        <button class="btn" style="padding:8px 20px; font-size:0.9em; background: #fff;" onclick="document.getElementById('fileIn').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å .json –≤—Ä–∞—á–∞</button>
        <input type="file" id="fileIn" class="hidden" accept=".json" onchange="handleFile(event)">
    </div>

    <div id="quiz-ui">
        <div style="text-align: center; font-size: 0.8em; font-weight: bold; color: #64748b;">
            <span id="counter-tag">1 / 40</span>
        </div>
        <div class="progress-line"><div class="fill" id="pb"></div></div>
        <div id="part-tag" class="status-text">–ë–æ–ª–µ—é—â–∏–π —á–µ–ª–æ–≤–µ–∫:</div>
        <div class="q-text" id="q-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="options no-print">
            <button class="btn" onclick="handleAns(1)">–ù–µ—Ç</button>
            <button class="btn" onclick="handleAns(2)">–°–∫–æ—Ä–µ–µ –Ω–µ—Ç</button>
            <button class="btn" onclick="handleAns(3)">–ù–µ –∑–Ω–∞—é</button>
            <button class="btn" onclick="handleAns(4)">–°–∫–æ—Ä–µ–µ –¥–∞</button>
            <button class="btn" onclick="handleAns(5)">–î–∞</button>
        </div>
    </div>

    <div id="report-ui" class="hidden">
        <h2 style="text-align:center; margin-top:0;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</h2>
        <div id="displayPatientName" style="text-align:center; font-weight:bold; margin-bottom:20px; color:var(--blue);"></div>
        <div id="scales-list"></div>
        <div id="total-val" style="margin-top:15px; padding:20px; background:var(--blue); color:white; border-radius:12px; text-align:center; font-weight:bold; font-size:1.2em;"></div>
        <button onclick="downloadJson()" class="btn no-print" style="width:100%; margin-top:20px; background:#059669; color:white; border:none;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <button onclick="window.print()" class="btn no-print" style="width:100%; margin-top:10px;">üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç—á–µ—Ç</button>
        <button onclick="location.reload()" class="btn no-print" style="width:100%; margin-top:10px; border:none; color:var(--blue);">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
</div>

<script>
    const questions = ["–ú–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –∑–ª–∏—Ç—å—Å—è, –∫–∞–ø—Ä–∏–∑–Ω–∏—á–∞—Ç—å, –æ–±–∏–∂–∞—Ç—å—Å—è", "–ò–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –æ—Ç–¥—ã—Ö", "–ú–æ–∂–µ—Ç –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ–ø—Ä–∏—è—Ç–Ω—É—é –¥–ª—è –Ω–µ–≥–æ —Ä–∞–±–æ—Ç—É", "–ò–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –≤–Ω–∏–º–∞–Ω–∏–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –±–ª–∏–∑–∫–∏—Ö", "–ò–º–µ–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ —Å–æ—á—É–≤—Å—Ç–≤–∏–µ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –æ–∫—Ä—É–∂–∞—é—â–∏—Ö", "–ú–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π", "–ú–æ–∂–µ—Ç –Ω–µ —Ä–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã", "–ú–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –±—ã—Ç—å —Å–ª–∞–±—ã–º", "–ú–æ–∂–µ—Ç —Ä–∞—Å–ø–æ—Ä—è–∂–∞—Ç—å—Å—è –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é", "–ú–æ–∂–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è–º –¥—Ä—É–≥–∏—Ö", "–ú–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫ —Å–µ–±–µ –æ—Å–æ–±–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è", "–ú–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ –≤—ã—Ä–∞–∂–∞—Ç—å —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞", "–ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º –∑–∞–±–æ—Ç—ã", "–ú–æ–∂–µ—Ç –Ω–µ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö", "–ú–æ–∂–µ—Ç –æ–ø—Ä–∞–≤–¥—ã–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–µ—É–¥–∞—á–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∑–¥–æ—Ä–æ–≤—å—è", "–ú–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—ã –Ω–∞ —Å–µ–±—è", "–ú–æ–∂–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–ª–∏–∑–∫–∏—Ö —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º", "–ú–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ç–∏—à–∏–Ω—ã –∏ –ø–æ–∫–æ—è", "–ú–æ–∂–µ—Ç –Ω–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –¥–æ–º–∞—à–Ω–∏–º–∏ –¥–µ–ª–∞–º–∏", "–ú–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏", "–î–æ–ª–∂–µ–Ω –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ—é –∂–∏–∑–Ω—å", "–û–±—è–∑–∞–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏", "–î–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å—Å—è —Å –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö", "–ú–æ–∂–µ—Ç –ª–∏—à–∏—Ç—å—Å—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –±–ª–∏–∑–∫–∏—Ö", "–î–æ–ª–∂–µ–Ω —Ä–µ—à–∞—Ç—å –Ω–∞–∫–æ–ø–∏–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã", "–û–±—è–∑–∞–Ω –≤—ã–π—Ç–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É/—É—á–µ–±—É", "–ú–æ–∂–µ—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –∫—Ä–∏—Ç–∏–∫–æ–π, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –±—ã–ª–æ –ø—Ä–∏ –±–æ–ª–µ–∑–Ω–∏", "–î–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º –Ω–æ—Ä–º–∞–º", "–¢–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –∫–∞–ø—Ä–∏–∑—ã –∏ –æ–±–∏–¥—ã", "–î–æ–ª–∂–µ–Ω —Å–∞–º –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –¥—Ä—É–≥–∏—Ö", "–ú–æ–∂–µ—Ç –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –æ–¥–∏–Ω–æ–∫–∏–º –±–µ–∑ –æ–ø–µ–∫–∏", "–î–æ–ª–∂–µ–Ω —Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ü–µ–ª–∏ –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –∏—Ö", "–¢–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏", "–î–æ–ª–∂–µ–Ω —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–∞–º–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ", "–û–±—è–∑–∞–Ω –±—ã—Ç—å ¬´—Å–∏–ª—å–Ω—ã–º¬ª", "–ú–æ–∂–µ—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é, –∫–æ—Ç–æ—Ä—É—é –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª", "–î–æ–ª–∂–µ–Ω –æ–ø—Ä–∞–≤–¥—ã–≤–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è –∏–ª–∏ —Å–µ–º—å–∏", "–¢–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –æ—Å–æ–±—ã–µ –ª—å–≥–æ—Ç—ã –∏ —Å–æ—á—É–≤—Å—Ç–≤–∏–µ", "–î–æ–ª–∂–µ–Ω –∑–∞–Ω–æ–≤–æ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –ª—é–¥—å–º–∏", "–ú–æ–∂–µ—Ç —Å–Ω–æ–≤–∞ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≥—Ä—É–∑ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –±—É–¥—É—â–µ–µ"];

    const scales = [
        { n: "–†–µ–≥—Ä–µ—Å—Å–∏—è", idx:[4, 12, 14, 15, 19], max: 25, t: "–ß–µ–º –±–æ–ª—å—à–µ –∏—Å–ø—ã—Ç—É–µ–º—ã–π —É—Ö–æ–¥–∏—Ç –≤ —Ä–µ–≥—Ä–µ—Å—Å–∏—é, –∏–∑–±–µ–≥–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –¥—É–º–∞–µ—Ç, —á—Ç–æ –ª—é–¥–∏, –ë–æ–≥ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã –∫ –Ω–µ–º—É, —Ç–µ–º –º–µ–Ω—å—à–µ –æ–Ω –º–æ–∂–µ—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö, –±–æ–ª–µ–µ –ø—Ä–∏—è—Ç–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –∏ —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –∞ –±–æ–ª—å—à–µ —Ä–∞–∑–º—ã—à–ª—è–µ—Ç –æ –ø–µ—Ä–µ–∂–∏—Ç—ã—Ö –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∏—è—Ö, —Ç–µ–º –¥–æ–ª—å—à–µ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏." },
        { n: "–¢—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏", idx:[1, 2, 5, 10, 17], max: 25, t: "–°–∏–º–ø—Ç–æ–º –∫–∞–∫ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞—è–≤–∏—Ç—å –æ —Å–≤–æ–∏—Ö –Ω—É–∂–¥–∞—Ö." },
        { n: "–ö–æ–Ω—Ñ–æ—Ä–º–∏–∑–º", idx:[3, 7, 8, 11, 20], max: 25, t: "–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–æ–ª–∏ –±–æ–ª—å–Ω–æ–≥–æ —Ä–∞–¥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–ø–µ–∫–∏." },
        { n: "–°–∏–º—É–ª—è—Ü–∏—è", idx:[6, 9, 13, 16, 18], max: 25, t: "–ü–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ—É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç—è–∂–µ—Å—Ç–∏ –¥–ª—è –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è –Ω–µ—É–¥–∞—á." },
        { n: "–†–µ—Å—É—Ä—Å—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è", idx:[25, 29, 35, 37], max: 20, t: "–°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–º—ã—Å–ª—ã –≤–Ω–µ –±–æ–ª–µ–∑–Ω–∏. –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑." },
        { n: "–¶–µ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è", idx:[30, 31, 33, 34], max: 20, t: "–°—Ç—Ä–∞—Ö –ø–µ—Ä–µ–¥ –∑–¥–æ—Ä–æ–≤–æ–π –∂–∏–∑–Ω—å—é –∏ –ø–æ—Ç–µ—Ä–µ–π –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π." },
        { n: "–ü—É—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è", idx:[21, 23, 27, 36], max: 20, t: "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –∫—Ä–∏–∑–∏—Å–∞." },
        { n: "–ê–≤—Ç–æ–Ω–æ–º–∏—è", idx:[22, 24, 26, 28, 40], max: 25, t: "–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å. –ù–∏–∑–∫–∏–π –±–∞–ª–ª ‚Äî –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –æ–ø–µ–∫–µ." }
    ];

    let currentIdx = 0, userAns = [];

    function showQ() {
        document.getElementById('q-text').innerText = questions[currentIdx];
        document.getElementById('counter-tag').innerText = (currentIdx + 1) + " / 40";
        document.getElementById('pb').style.width = (currentIdx / 40 * 100) + "%";
        document.getElementById('part-tag').innerText = currentIdx < 20 ? "–ë–æ–ª–µ—é—â–∏–π —á–µ–ª–æ–≤–µ–∫" : "–í—ã–∑–¥–æ—Ä–∞–≤–ª–∏–≤–∞—é—â–∏–π:";
    }

    function handleAns(v) {
        userAns.push(v);
        currentIdx++;
        if(currentIdx < 40) showQ(); else renderReport();
    }

    function renderReport() {
        const name = document.getElementById('patientName').value || "–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–∞—Ü–∏–µ–Ω—Ç";
        document.getElementById('quiz-ui').classList.add('hidden');
        document.getElementById('start-ui').classList.add('hidden');
        document.getElementById('report-ui').classList.remove('hidden');
        document.getElementById('displayPatientName').innerText = "–ü–∞—Ü–∏–µ–Ω—Ç: " + name;
        let sumTotal = 0, html = '';
        scales.forEach((s) => {
            const score = s.idx.reduce((acc, q) => acc + userAns[q-1], 0);
            sumTotal += score;
            const p = (score/s.max)*100;
            html += `<div class="scale-box"><div class="scale-head" onclick="this.nextElementSibling.classList.toggle('open')"><span>${s.n}</span><div style="display:flex; align-items:center;"><span>${score} –±.</span><div class="bar-wrap"><div class="bar-inner" style="width:${p}%"></div></div></div></div><div class="scale-body">${s.t}</div></div>`;
        });
        document.getElementById('scales-list').innerHTML = html;
        document.getElementById('total-val').innerText = "–û–ë–©–ò–ô –£–†–û–í–ï–ù–¨: " + sumTotal;
    }

    function downloadJson() {
        const name = document.getElementById('patientName').value || "Patient";
        const data = JSON.stringify({ans: userAns, name: name});
        const blob = new Blob([data], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${name}_${new Date().toISOString().slice(0,10)}.json`;
        a.click();
    }

    function handleFile(e) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = JSON.parse(e.target.result);
            if(data.ans) { userAns = data.ans; document.getElementById('patientName').value = data.name || ""; renderReport(); }
        };
        reader.readAsText(e.target.files[0]);
    }
    showQ();
</script>
</body>
</html>
